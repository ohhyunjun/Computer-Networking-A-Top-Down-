# 네트워크 계층

네트워크 계층은 송신측 호스트에서 수신측 호스트까지 패킷을 IP 주소로 구분하며 라우팅하는 계층입니다.

## 1. 라우팅 프로토콜

- **Datagram Network**: 사전 연결 설정 없이 라우터는 종단 간 연결을 유지하지 않습니다. 패킷은 목적지 호스트의 주소를 기반으로 다양한 경로를 통해 전달됩니다.
- **라우팅**: 출발지에서 목적지까지 데이터 패킷의 최적 경로를 선택하는 과정입니다.
- **라우팅 테이블**: 목적지 주소를 해당 네트워크 노선으로 변환하며, 다음 홉(hop) 정보와 비용을 제공합니다.

### 1.1 라우팅 알고리즘 분류

#### (1) 정보 공유 방식
- **Global (Link State Routing)**:
  - 네트워크 전체 정보를 바탕으로 최소 비용 경로를 계산합니다.
  - 모든 노드가 사전에 전체 정보를 교환합니다.
  - **Dijkstra's Algorithm**:
    - `c(i, j)`: 노드 `i`에서 `j`까지의 비용.
    - `D(v)`: 출발지에서 노드 `v`까지의 총 비용.
    - `p(v)`: 노드 `v`까지의 경로에서 이전 노드.
    - `N`: 경로에 포함된 노드 집합.
- **Decentralized (Distance Vector Routing)**:
  - 라우터는 이웃 노드와만 링크 비용 정보를 교환합니다.
  - 사전 작업 없이 정보 교환을 반복하며 최소 비용 경로를 계산합니다.
  - 특징: **분산적**, **반복적**, **비동기적**.
  - 공식: `D^x(Y, Z) = c(x, Y) + min_w{D^Z(Y, w)}`
    - `D^x(Y, Z)`: 노드 `x`에서 `Y`까지, `Z`를 거치는 비용.

#### (2) 변화 적응 방식
- **Static**: 라우팅 경로가 시간에 따라 느리게 변화합니다.
- **Dynamic**: 네트워크 트래픽 부하 또는 토폴로지 변화에 따라 빠르게 경로를 변경합니다.

## 2. IP (Internet Protocol)

### 2.1 특징
- **비신뢰성**: 가능한 범위 내에서 패킷을 목적지까지 전달하는 최선형 서비스.
- **비접속형**: 연결 설정 없이 패킷을 전송.
- **주소 지정**: IP 주소를 통해 네트워크 내 노드를 고유하게 식별.
- **경로 결정**: 목적지 IP 주소를 기반으로 패킷 전달 경로를 판단.

### 2.2 구성
- **헤더 필드**: 패킷 전송에 필요한 정보.
- **데이터 필드**: 실제 전송 데이터.

### 2.3 체제
- 모든 장비는 고유한 논리적 네트워크 식별자를 가짐.
- IP 주소는 **네트워크 식별자**와 **호스트 식별자**로 구성.
  - 네트워크 주소: 모두 `0`.
  - 브로드캐스트 주소: 모두 `1`.

#### IP 주소 클래스
- **A 클래스**:
  - 형식: `0XXXXXXX.XXXXXXXX.XXXXXXXX.XXXXXXXX` (1~126).
  - 호스트 수: `2^(32-8) - 2 = 2^24 - 2` (네트워크 주소와 브로드캐스트 주소 제외).
  - 예: `13.0.0.0 ~ 13.255.255.255`.
- **B 클래스**:
  - 형식: `10XXXXXX.XXXXXXXX.XXXXXXXX.XXXXXXXX` (128.0.0.0~191.255.255.255).
  - 호스트 수: `2^16 - 2`.
- **C 클래스**:
  - 형식: `110XXXXX.XXXXXXXX.XXXXXXXX.XXXXXXXX` (192.0.0.0~223.255.255.255).
  - 호스트 수: `2^8 - 2`.
- **D 클래스**: 멀티캐스트용.
- **E 클래스**: 예약된 주소.

### 2.4 IPv4 전송 방식
- **유니캐스트**:
  - 1:1 전송.
  - 단점: 대역폭 낭비, 수신자 증가 시 송신자 부하 증가.
- **멀티캐스트**:
  - 1:다수 전송, 멀티캐스트 주소 소유자에 한함.
  - 장점: 중복 패킷 전송 방지, 시간 지연 감소.
  - **MBone**: 멀티캐스트 지원 장비로 구성된 가상 네트워크 (터널링 기법 사용).
  - **IGMP**: 멀티캐스트 그룹 관리 프로토콜.
- **브로컬캐스트**:
  - 네트워크 내 모든 호스트에 패킷 전송.

### 2.5 IPv6
- **배경**:
  - IPv4 주소 부족 문제 (NAT, DHCP로 해결 시도, 부족).
  - 다양한 단말기/서비스 증가, 보안 취약성 문제.
- **특징**:
  - 128비트, 16비트씩 8자리로 16진수 표현.
  - 보안 강화, 라우팅 효율성 향상, QoS 보장, 무선 인터넷 지원, 헤더 단순화.
  - **자동 주소 설정**:
    - 상태 보존형: 라우터 제공 네트워크 프리픽스 + MAC 주소.
    - 비상태형: 자동 설정.
- **구성**:
  - **기본 헤더**: 40바이트, 송수신 주소 및 전송 정보.
  - **확장 헤더**: 추가 기능 필요 시 선택적 추가.
  - **데이터 필드**: TCP 세그먼트, UDP 데이터그램 등.
- **주소 종류**:
  - **유니캐스트**: 단일 인터페이스 식별.
  - **멀티캐스트**: 인터페이스 그룹 식별, 그룹 내 모든 인터페이스에 전달.
  - **애니캐스트**: 가장 가까운 인터페이스에 전달.

## 3. 모바일 IP

모바일 IP는 호스트의 이동성을 지원하며, 모바일 노드가 네트워크를 이동하면서도 인터넷 연결을 유지하도록 설계되었습니다.

### 3.1 주요 구성 요소
- **CN (Correspondent Node)**: 이동 노드와 통신하는 노드.
- **MN (Mobile Node)**: 이동 노드.
- **HA (Home Agent)**: MN이 처음 속한 네트워크.
- **HN (Home Network)**: MN의 HA에 속한 라우터.
- **FA (Foreign Agent)**: MN이 이동 후 속한 라우터.
- **FN (Foreign Network)**: MN이 이동 후 속한 네트워크.
- **CoA (Care-of Address)**: MN에 임시 부여된 IP 주소.

### 3.2 모바일 IPv4
- **동작**:
  - 초기 MN이 CoA를 받는 과정
     ![Image](https://github.com/user-attachments/assets/9d2a19bc-4eec-478b-ae79-9b3b626dd4ce) 
  - 통신 과정
    ![Image](https://github.com/user-attachments/assets/b0c94f0d-822c-4490-80e9-70a5355982b8) 
    (1) CN은 MN의 임시 위치를 모르므로 패킷을 HA로 전송.
    (2) HA는 맵핑된 CoA로 패킷을 전달.
    (3) MN은 CN에 직접 패킷을 전송.
- **문제점**: 삼각 라우팅 (비효율적 경로).

### 3.3 모바일 IPv6
- **개선점**:
  - FA 불필요, MN이 직접 CoA 생성.
  - 경로 최적화: MN이 CoA를 HA와 CN에 전송, CN과 직접 통신.
- **장점**: 삼각 라우팅 문제 해결.

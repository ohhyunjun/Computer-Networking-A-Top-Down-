# 4. 네트워크 계층 (Network Layer)

송신측 호스트에서 수신측 호스트까지 **패킷을 IP 주소로 구분하며 라우팅**하는 계층

---

## 4.1 라우팅 프로토콜 (Routing Protocol)

### 기본 개념
- **Datagram network**: 연결(set up) 없이 라우팅하며, 각 패킷은 목적지 주소를 바탕으로 경로를 독립적으로 결정
- **라우팅(Routing)**: 최적 경로 선택 알고리즘에 따라 데이터를 목적지까지 전달
- **라우팅 테이블(Routing Table)**: 목적지 주소와 연결된 다음 라우터 정보 및 비용을 포함

---

### 라우팅 알고리즘 분류

| 분류 | 설명 |
|------|------|
| **Global** | 전체 네트워크 정보를 기반으로 라우팅 경로 결정 |
| - Link State Routing | Dijkstra 알고리즘 기반, 전체 비용 계산 후 최적 경로 설정 |
| **Decentralized** | 이웃 노드들과만 정보를 교환하며 라우팅 |
| - Distance Vector Routing | 분산적이며 반복적, 비동기적으로 동작<br>예시: `Dx(Y, Z) = c(x, Y) + min_w{Dz(Y, w)}` |
| **Static** | 네트워크 환경이 잘 변하지 않을 때 사용 |
| **Dynamic** | 네트워크 상태에 따라 실시간으로 경로 변경 |

---

## 4.2 IP (Internet Protocol)

### 특징
- **비신뢰성**: 가능한 최선을 다해 전송하지만 보장하지 않음
- **비접속형**: 연결 설정 없이 전송
- **주소지정**: 고유한 IP주소를 통해 노드 식별
- **경로결정**: 목적지 IP주소 기반

---

### 구성
- **헤더 필드** + **데이터 필드**

---

### IP 주소 클래스 (IPv4 기준)

| 클래스 | 주소 범위 | 호스트 수 | 특징 |
|--------|-----------|-----------|------|
| A | `1.0.0.0 ~ 126.255.255.255` | `2^24 - 2` | 대규모 네트워크용 |
| B | `128.0.0.0 ~ 191.255.255.255` | `2^16 - 2` | 중규모 네트워크용 |
| C | `192.0.0.0 ~ 223.255.255.255` | `2^8 - 2` | 소규모 네트워크용 |
| D | `224.0.0.0 ~ 239.255.255.255` | - | 멀티캐스트 용도 |
| E | `240.0.0.0 ~ 255.255.255.255` | - | 실험 및 예약용 |

> ※ `-2`는 네트워크 주소 및 브로드캐스트 주소 제외

---

### IPv4 전송 방식

- **Unicast**: 단일 수신자
- **Broadcast**: 동일 네트워크 내 전체 수신자
- **Multicast**: 다수의 특정 수신자 그룹
  - **IGMP**: 멀티캐스트 그룹 관리를 위한 프로토콜
  - **MBone**: 멀티캐스트 전용 가상 네트워크

---

### IPv6

IPv4의 한계를 극복하기 위해 개발된 프로토콜 (128bit 주소)

#### 주요 특징
- 16진수 8구간 (`xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx:xxxx`)
- 보안 강화, QoS 보장, 헤더 단순화, 무선 인터넷 최적화
- 자동 주소 설정: 상태 보존형 / 비상태형 (MAC + 프리픽스)

#### 구성 요소
- **기본 헤더** (40byte)
- **확장 헤더** (선택적 추가)
- **데이터 필드** (상위 계층 데이터 포함)

#### 주소 유형

| 유형 | 설명 |
|------|------|
| **Unicast** | 하나의 인터페이스에 전송 |
| **Multicast** | 그룹 전체 인터페이스에 전송 |
| **Anycast** | 가장 가까운 인터페이스 하나에만 전송 |

---

## 4.3 모바일 IP (Mobile IP)

모바일 환경에서도 **고정된 IP주소 유지** 가능하도록 설계된 IP 구조

### 구성 요소

| 약어 | 의미 |
|------|------|
| **MN** | Mobile Node (이동 노드) |
| **CN** | Correspondent Node (통신 상대 노드) |
| **HA** | Home Agent (기존 네트워크 라우터) |
| **FA** | Foreign Agent (새로운 네트워크 라우터) |
| **CoA** | Care-of Address (임시 IP 주소) |

---

### Mobile IPv4

1. **CN → MN**: CN이 패킷을 HA로 전송  
2. **HA → MN(CoA)**: HA는 CoA로 전달 (삼각 라우팅 발생)  
3. **MN → CN**: MN은 CN으로 직접 전송

> 삼각라우팅(Triangular Routing): 비효율적인 경로 발생

---

### Mobile IPv6

- **FA 없이 동작 가능**
- MN이 직접 CoA 생성 후 CN과 HA에 통보
- **CN과 직접 통신 가능** → 경로 최적화 및 삼각라우팅 문제 해결

---
